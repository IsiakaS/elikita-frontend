<mat-card class="ms-30 me-30">
    <mat-card-header>
        <div class="g-just-flex flex-between w-100 flex-wrap gap-20">
            <div class="left">
                <mat-card-title class="">
                    Medication Requests

                </mat-card-title>
                <mat-card-subtitle>
                    Find, search and add current and past medication requests
                </mat-card-subtitle>
            </div>
            <div class="right gap-10 g-just-flex">
                <a mat-flat-button extended class="secondary-button small-button">
                    <mat-icon>file_download</mat-icon> Export
                </a>



            </div>
        </div>
    </mat-card-header>

    <mat-card-content class="my-12">
        <mat-divider></mat-divider>
        <app-table-header [patientsTableFilterArray]="  tableFilter"
            [patientsFiltersFormControlObject]=" tableFilterFormControlObject">

        </app-table-header>


        <table mat-table matSort [dataSource]="tableDataSource" class="mat-elevation-z8 demo-table">

            <!--name - coding.code.display-->
            <ng-container matColumnDef="date_prescribed">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="date_prescribed"
                    sortActionDescription="Sort by Date">
                    Date Prescribed
                </th>
                <td mat-cell *matCellDef="let element">{{element.authoredOn}}</td>
            </ng-container>

            <ng-container matColumnDef="action">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="action">
                    Action
                </th>
                <td mat-cell *matCellDef="let element; let i = index;">
                    <mat-icon [mat-menu-trigger-for]="mem">more_vert</mat-icon>
                    <mat-menu #mem="matMenu" class="action-menu">
                        <a (click)="viewDetails(element)">

                            <span>
                                View Details
                            </span>
                            <mat-icon class="">
                                chevron_right
                            </mat-icon>
                        </a>
                        <a (click)="administer(element)">

                            <mat-icon class="">
                                vaccines
                            </mat-icon>
                            <span>
                                Administer
                            </span>
                        </a>

                    </mat-menu>
                </td>
            </ng-container>

            <!--dateRecorded - recordedDateTime -->
            <ng-container matColumnDef="medication">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="medication"
                    sortActionDescription="Sort by Medication">
                    MedicationId
                </th>
                <td mat-cell *matCellDef="let element; let i = index;" #td>
                    <div class="g-just-flex gap-0 my-12" style="justify-content: flex-start; align-items: center;">
                        <div class="g-just-flex gap-5"
                            style="justify-content: flex-start; align-items: flex-start; flex-direction: column;">
                            <div class="top">
                                {{element.medication | codeableRef2}}


                            </div>
                            @if(isLinkObj['medication'] && isLinkObj['medication'].get(i)) {
                            <div class="bottom subtitle-text-color-2">
                                @if((element.medication.reference | fetchFromReference : 'code': 'coding': 0 : 'display'
                                )| async){
                                {{element.medication.reference | fetchFromReference : 'code': 'coding': 0 : 'display' |
                                async}}
                                }@else{
                                <div style="width:10px; height: 10px;">
                                    <mat-progress-spinner mode="indeterminate"
                                        style="width:10px !important; height: 10px; !important">

                                    </mat-progress-spinner>
                                </div>

                                }


                            </div>
                            }
                        </div>
                        <div>
                            @if(isLinkObj['medication'] && isLinkObj['medication'].get(i)) {
                            <div (click)="alltds(td)">


                                <mat-expansion-panel hideToggle="true" class="detail-base" style="box-shadow: none;">
                                    <mat-expansion-panel-header style="margin: 0px; padding: 0px;">
                                        <mat-panel-title style="margin-right: 0px;">
                                            <mat-icon style="margin: 0px; padding: 0px;">chevron_right</mat-icon>
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <ng-template matExpansionPanelContent>
                                        <!-- <span>jjjj</span> -->
                                        <app-detail-base [url]="isLinkObj['medication'].get(i)"></app-detail-base>
                                    </ng-template>
                                </mat-expansion-panel>
                            </div>
                            }
                        </div>
                    </div>
                </td>
            </ng-container>

            <!--category - category.coding.display -->
            <ng-container matColumnDef="dosage_instruction">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="dosage_instruction"
                    sortActionDescription="Sort by Dosage">
                    Dosage
                </th>
                <td mat-cell *matCellDef="let element"> <span
                        [innerHTML]="element.renderedDosageInstruction || element.dosageInstruction?.[0]?.text"></span>
                </td>
            </ng-container>

            <!--verificationStatus - verificationStatus.coding[0].code   -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="staus" sortActionDescription="Sort by Status">
                    Request Status
                </th>
                <td mat-cell *matCellDef="let element">
                    <div #sc style="margin: 0px !important;"
                        [attr.class]="'small-chips'+' '+'status-'+statusStyles[element.status]['color']+' g-just-flex gap-8'">

                        <span> {{element.status}}

                        </span>
                        <mat-icon>
                            {{statusStyles[element.status]['icon']}}
                        </mat-icon>

                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="subject">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="staus" sortActionDescription="Sort by Subject">
                    PatientId
                </th>
                <td mat-cell *matCellDef="let element; let i = index;" #td>
                    <div class="g-just-flex gap-0 my-12" style="justify-content: flex-start; align-items: center;">
                        <div class="g-just-flex gap-5"
                            style="justify-content: flex-start; align-items: flex-start; flex-direction: column;">
                            <div class="top">
                                {{element.subject | references2}}


                            </div>
                            @if(isLinkObj['subject'].get(i)) {
                            <div class="bottom subtitle-text-color-2">
                                @if((element.subject | fetchFromReference : 'name': 0 : 'family' )| async){
                                {{element.subject | fetchFromReference : 'name': 0 : 'family' | async}}
                                }@else{
                                <div style="width:10px; height: 10px;">
                                    <mat-progress-spinner mode="indeterminate" style="width:10px; height: 10px;">

                                    </mat-progress-spinner>
                                </div>

                                }


                            </div>
                            }
                        </div>
                        <div>
                            @if(isLinkObj['subject'].get(i)) {
                            <div (click)="alltds(td)">


                                <mat-expansion-panel hideToggle="true" class="detail-base" style="box-shadow: none;">
                                    <mat-expansion-panel-header style="margin: 0px; padding: 0px;">
                                        <mat-panel-title style="margin-right: 0px;">
                                            <mat-icon style="margin: 0px; padding: 0px;">chevron_right</mat-icon>
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                    <ng-template matExpansionPanelContent>
                                        <!-- <span>jjjj</span> -->
                                        <app-detail-base [url]="isLinkObj['subject'].get(i)"></app-detail-base>
                                    </ng-template>
                                </mat-expansion-panel>
                            </div>
                            }
                        </div>
                    </div>


                </td>
            </ng-container>

            <!--clinicalStatus - clinicalStatus.coding[0].code -->


            <tr mat-header-row *matHeaderRowDef="tableColumns"></tr>
            <tr mat-row *matRowDef="let row; let dataIndex = dataIndex; columns: tableColumns" (click)="showRow(row)">
            </tr>
        </table>
    </mat-card-content>
</mat-card>