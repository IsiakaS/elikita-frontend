<mat-card>
    <mat-card-header>
        <div class="g-just-flex flex-between w-100 flex-wrap gap-20">
            <div class="left">
                <mat-card-title class="">
                    Clinical Observations for
                    <a (click)="patientOpenAndClose.openPatientDetailsStrip()" style="text-decoration: none;"
                        [routerLink]="['/patients', patientId]" routerLinkActive="router-link-active">
                        {{patientName | async}}
                    </a>
                </mat-card-title>
                <mat-card-subtitle>
                    Find, search and add lab results, vital signs and other Clinical Observations for tis patient
                </mat-card-subtitle>
            </div>
            <div class="right gap-10 g-just-flex">
                <a mat-flat-button extended class="secondary-button small-button">
                    <mat-icon>file_download</mat-icon> Export
                </a>
                <a mat-flat-button class="">
                    <mat-icon>add</mat-icon>
                    Add Observations
                </a>


            </div>
        </div>
    </mat-card-header>

    <mat-card-content class="my-12">
        <mat-divider></mat-divider>
        <app-table-header [patientsTableFilterArray]="  patientObservationTableFilterArray"
            [patientsFiltersFormControlObject]=" patientObservationFiltersFormControlObject">

        </app-table-header>



        <table mat-table matSort [dataSource]="tableDataSource" class="mat-elevation-z8 demo-table">

            <!--name - coding.code.display-->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="name" sortActionDescription="Sort by Name">
                    Name
                </th>
                <td mat-cell *matCellDef="let element">{{element.code.coding[0].display | titlecase}}</td>
            </ng-container>
            <!---->
            <!--dateTaken - effectiveDateTime -->
            <ng-container matColumnDef="dateTaken">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="dateTaken"
                    sortActionDescription="Sort by Date Taken">
                    Date Taken
                </th>
                <td mat-cell *matCellDef="let element">{{element.effectiveDateTime | date: 'medium'}}</td>
            </ng-container>
            <!--category - category.coding.display -->
            <ng-container matColumnDef="category">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="category"
                    sortActionDescription="Sort by Category">
                    Category
                </th>
                <td mat-cell *matCellDef="let element">{{element.category[0].coding[0].display | titlecase}}</td>
            </ng-container>
            <!--result - valueQuantity.value -->
            <ng-container matColumnDef="result">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="result" sortActionDescription="Sort by Result">
                    Result
                </th>
                <td mat-cell *matCellDef="let element">{{element.valueQuantity?.value}}{{element.valueQuantity?.unit}}
                </td>
            </ng-container>
            <!--normal referenceRange.low.value+referenceRange.low.unit
            +" to "+referenceRange.high.value+referenceRange.high.unit -->
            <ng-container matColumnDef="normal_range">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="normal_range"
                    sortActionDescription="Sort by Normal Range">
                    Normal Range
                </th>
                <td mat-cell *matCellDef="let element">
                    {{element.referenceRange?.[0].low.value}}{{element.referenceRange?.[0].low.unit}}
                    to {{element.referenceRange?.[0].high.value}}{{element.referenceRange?.[0].high.unit}}</td>

            </ng-container>
            <!--status - status -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="status" sortActionDescription="Sort by Status">
                    Status
                </th>
                <td mat-cell *matCellDef="let element">{{element.status | titlecase}}</td>
            </ng-container>
            <!-- practitioner - performer.reference -->
            <ng-container matColumnDef="practitioner">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="practitioner"
                    sortActionDescription="Sort by Practitioner">
                    Practitioner
                </th>
                <td mat-cell *matCellDef="let element">
                    {{references.get(element.performer[0].reference)['name'][0].given[0]
                    + ' ' + references.get(element.performer[0].reference)['name'][0].family
                    }}</td>
            </ng-container>







            <tr mat-header-row *matHeaderRowDef="patientObservationDisplayedColumns" matHeaderRowDefSticky="true">
            </tr>
            <tr mat-row (click)="showRow(row)" *matRowDef="let row; columns:patientObservationDisplayedColumns;"></tr>
        </table>

    </mat-card-content>
</mat-card>